<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SlugBrawl</title>
<style>
body{margin:0;background:#0b1220;color:#fff;font-family:Arial}
#menu{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
#box{background:#111827;padding:20px;border-radius:14px;width:280px}
input,button{width:100%;margin-top:10px;padding:12px;border-radius:10px;border:none}
button{background:#facc15;font-weight:bold}
canvas{display:block}
#joy{position:fixed;left:20px;bottom:20px;width:120px;height:120px;
background:rgba(255,255,255,.15);border-radius:50%}
</style>
</head>
<body>

<div id="menu">
  <div id="box">
    <h2>SlugBrawl</h2>
    <input id="name" placeholder="Nome">
    <input id="room" placeholder="Sala">
    <button id="joinBtn">ENTRAR</button>
  </div>
</div>

<canvas id="c"></canvas>
<div id="joy"></div>

<script>
const c=document.getElementById("c");
const ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

let ws=null,myId=null,snap=null;
let move={x:0,y:0};

function join(){
  ws=new WebSocket((location.protocol==="https:"?"wss://":"ws://")+location.host);
  ws.onopen=()=>{
    ws.send(JSON.stringify({
      t:"join",
      name:document.getElementById("name").value,
      room:document.getElementById("room").value
    }));
  };
  ws.onmessage=e=>{
    const m=JSON.parse(e.data);
    if(m.t==="you"){
      myId=m.id;
      document.getElementById("menu").style.display="none";
    }
    if(m.t==="snap") snap=m.r;
  };
}

document.getElementById("joinBtn").onclick=join;

// joystick simples
const joy=document.getElementById("joy");
joy.onpointermove=e=>{
  if(!e.buttons) return;
  move.x=(e.movementX)/20;
  move.y=(e.movementY)/20;
  if(ws&&ws.readyState===1){
    ws.send(JSON.stringify({t:"input",ix:move.x,iy:move.y}));
  }
};

function loop(){
  if(!snap||!myId) return requestAnimationFrame(loop);
  ctx.clearRect(0,0,c.width,c.height);
  for(const p of Object.values(snap.players)){
    ctx.fillStyle=p.id===myId?"#22c55e":"#ef4444";
    ctx.beginPath();ctx.arc(p.x,p.y,18,0,Math.PI*2);ctx.fill();
  }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
