<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SlugBrawl</title>
<style>
body{margin:0;background:#071022;color:#fff;font-family:Arial;overflow:hidden}
#menu{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.7);z-index:10}
#box{width:90%;max-width:360px;background:#111827;padding:16px;border-radius:14px}
input,select,button{width:100%;margin-top:10px;padding:12px;border-radius:10px;border:none;font-weight:bold}
button{background:#facc15;color:#000}
canvas{display:block}
#joy{position:fixed;left:20px;bottom:20px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.15)}
#fire{position:fixed;right:20px;bottom:60px;width:100px;height:60px;border-radius:16px;background:#facc15;color:#000;display:flex;align-items:center;justify-content:center;font-weight:bold}
#hud{position:fixed;top:10px;left:10px;font-weight:bold}
</style>
</head>
<body>

<div id="menu">
  <div id="box">
    <h2>SlugBrawl</h2>
    <input id="name" placeholder="Nome">
    <input id="room" placeholder="Sala">
    <select id="cls">
      <option value="soldier">Soldado</option>
      <option value="tank">Tank</option>
    </select>
    <button onclick="join()">ENTRAR</button>
  </div>
</div>

<div id="hud">Clique ENTRAR</div>
<canvas id="c"></canvas>
<div id="joy"></div>
<div id="fire">ATIRAR</div>

<script>
const c=document.getElementById("c"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
addEventListener("resize",resize);resize();

const WS_URL=(location.protocol==="https:"?"wss://":"ws://")+location.hostname;
let ws,myId,snap,move={x:0,y:0};

window.join=function(){
  document.getElementById("hud").textContent="Conectandoâ€¦";
  ws=new WebSocket(WS_URL);
  ws.onopen=()=>{
    ws.send(JSON.stringify({
      t:"join",
      name:document.getElementById("name").value,
      room:document.getElementById("room").value,
      cls:document.getElementById("cls").value
    }));
  };
  ws.onmessage=e=>{
    const m=JSON.parse(e.data);
    if(m.t==="you"){
      myId=m.id;
      document.getElementById("menu").style.display="none";
      document.getElementById("hud").textContent="Jogando";
    }
    if(m.t==="snap") snap=m.r;
  };
};

const joy=document.getElementById("joy");
joy.onpointermove=e=>{
  if(!e.buttons) return;
  move.x=e.movementX/30;
  move.y=e.movementY/30;
  if(ws&&ws.readyState===1){
    ws.send(JSON.stringify({t:"input",ix:move.x,iy:move.y,aimX:move.x,aimY:move.y}));
  }
};

document.getElementById("fire").onpointerdown=()=>{
  if(ws&&ws.readyState===1) ws.send(JSON.stringify({t:"shoot"}));
};

function loop(){
  if(!snap||!myId){requestAnimationFrame(loop);return;}
  ctx.clearRect(0,0,c.width,c.height);
  for(const p of Object.values(snap.players)){
    ctx.fillStyle=p.id===myId?"#22c55e":"#ef4444";
    ctx.beginPath();ctx.arc(p.x,p.y,18,0,Math.PI*2);ctx.fill();
  }
  for(const e of snap.enemies){
    ctx.fillStyle="#f59e0b";
    ctx.beginPath();ctx.arc(e.x,e.y,16,0,Math.PI*2);ctx.fill();
  }
  for(const b of snap.bullets){
    ctx.fillStyle="#ffd60a";
    ctx.fillRect(b.x-3,b.y-3,6,6);
  }
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
